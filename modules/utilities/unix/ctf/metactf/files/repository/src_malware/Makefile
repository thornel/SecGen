# Unused dirs: Beta
SUBDIRS = Ch01-08 Ch11-13 Ch15-16 Ch18-21

export WWWDIR_OBJ=$(PWD)/www/static/obj
export WWWDIR_LOG=$(PWD)/www/static/logs
export USERS=$(shell cut -d" " -f 1 users)

.PHONY : all wwwusers $(SUBDIRS) install clean distclean

all:
	$(foreach dir,$(SUBDIRS),cd $(dir) && $(MAKE) && cd ..;)

wwwusers:
	python3 wwwusers.py

$(SUBDIRS):
	cd $@ && $(MAKE)

install: wwwusers
	$(foreach dir,$(SUBDIRS),cd $(dir) && $(MAKE) install && cd ..;)
	echo "==========================================================="
	echo "Note: You must perform a restart on the systemd service for"
	echo "	uwsgi to reload any new accounts. Service is named based "
	echo "  on hostname used for site.  Example for foo.oregonctf.org"
	echo "     sudo systemctl restart foo                            "
	echo "==========================================================="

clean:
	$(foreach dir,$(SUBDIRS),cd $(dir) && $(MAKE) clean && cd ..;)

distclean: clean
	rm -rf $(WWWDIR_OBJ);
	rm -rf $(WWWDIR_LOG);
